<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Willie McClain | Cybersecurity Portfolio</title>
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Share Tech Mono', monospace, Arial, sans-serif;
      background: #10141a;
      color: #e0e0e0;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      overflow: hidden;
    }
    #matrix-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      display: none;
    }
    .scanlines {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: linear-gradient(to bottom, rgba(16, 20, 26, 0), rgba(16, 20, 26, 0.4) 50%, rgba(16, 20, 26, 0));
        background-size: 100% 4px;
        opacity: 0.3;
        pointer-events: none;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 16px 64px 16px;
      display: none;
      position: relative;
      z-index: 2;
    }
    header {
      padding-top: 44px;
      padding-bottom: 30px;
      text-align: center;
      position: relative;
    }
    #lock-button {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: 1px solid #47ffa8;
      color: #47ffa8;
      padding: 8px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    #lock-button:hover {
      background: #47ffa8;
      color: #10141a;
      box-shadow: 0 0 15px #47ffa8;
    }
    h1 {
      font-size: 4.2rem;
      letter-spacing: 1px;
      margin-bottom: 8px;
      color: #6ef1a6;
      text-shadow: 0 0 12px #214d39, 0 0 2px #6ef1a6;
      line-height: 1.1;
    }
    h1 strong {
        font-size: 1.5rem;
        display: block;
        margin-top: 12px;
        color: #a0f0c3;
        font-weight: normal;
    }
    h2 {
      font-size: 1.45rem;
      margin-top: 44px;
      color: #61d2ff;
      text-shadow: 0 0 4px #214d39;
    }
    h3 {
      color: #e082ff;
      font-size: 1.1rem;
      margin-top: 32px;
      margin-bottom: 8px;
    }
    .card-list {
      display: grid;
      gap: 28px;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      margin-top: 16px;
    }
    .card {
      background: rgba(36, 41, 61, 0.92);
      border-radius: 1.1rem;
      box-shadow: 0 2px 18px 0 #000a;
      padding: 24px 20px 20px 20px;
      border-left: 4px solid #47ffa8;
      transition: transform 0.12s, box-shadow 0.12s;
      min-height: 120px;
      position: relative;
    }
    .card:hover {
      transform: translateY(-6px) scale(1.04);
      box-shadow: 0 8px 32px 2px #3eebbb77;
      border-left-color: #61d2ff;
    }
    .card-title {
      font-size: 1.16rem;
      font-weight: bold;
      margin-bottom: 4px;
      color: #6ef1a6;
      text-decoration: none;
    }
    .card-desc {
      font-size: 1rem;
      color: #e0e0e0;
    }
    .card-label {
      background: #181d2a;
      color: #7ce2a0;
      font-size: 0.88rem;
      padding: 1px 9px 1px 9px;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 6px;
      margin-right: 6px;
    }
    .links {
      margin-top: 32px;
      text-align: center;
    }
    .links a {
      display: inline-block;
      margin: 0 10px 18px 10px;
      background: #181d2a;
      border-radius: 6px;
      padding: 12px 16px;
      color: #6ef1a6;
      text-decoration: none;
      font-weight: bold;
      font-size: 1rem;
      box-shadow: 0 2px 8px #213b2c66;
      transition: background 0.1s, color 0.1s;
    }
    .links a:hover {
      background: #6ef1a6;
      color: #212b24;
    }
    .social {
      margin-top: 20px;
      text-align: center;
    }
    .social a {
      margin: 0 6px;
      display: inline-block;
    }
    .social img {
      width: 26px;
      filter: drop-shadow(0 0 5px #61d2ff88);
    }
    .about, .videos {
      margin-top: 42px;
      padding: 18px 26px 18px 26px;
      background: rgba(34,40,58,0.77);
      border-radius: 1rem;
      box-shadow: 0 2px 14px 0 #0006;
      color: #e0e0e0;
      font-size: 1.03rem;
      line-height: 1.7;
    }
    .disclaimer {
        padding: 12px;
        background: rgba(255, 0, 0, 0.1);
        border-left: 4px solid #f00;
        border-radius: 4px;
        margin-top: 16px;
        color: #ff6b6b;
    }
    .disclaimer strong {
        color: #ff8787;
    }
    @media (max-width: 700px) {
      .container { padding: 12px 1vw 36px 1vw; }
      h1 { font-size: 3rem; }
      h1 strong { font-size: 1.2rem; }
      h2 { font-size: 1.08rem; }
      .card-list { grid-template-columns: 1fr; }
    }

    /* --- LOADING & LOCKING SEQUENCE STYLES --- */
    #loading-overlay {
        position: fixed;
        inset: 0;
        background-color: #10141a;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        font-family: 'Share Tech Mono', monospace;
        transition: opacity 0.5s ease-in-out;
    }
    #lock-overlay {
        position: fixed;
        inset: 0;
        background-color: #10141a;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        font-family: 'Share Tech Mono', monospace;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    #lock-terminal {
        width: 100%;
        max-width: 600px;
        padding: 1rem;
        color: #ff6b6b;
    }
    #login-input {
      background-color: transparent;
      border: none;
      outline: none;
      color: #6ef1a6;
      caret-color: #0F0;
      font-family: 'Share Tech Mono', monospace;
      font-size: inherit;
    }
    .boot-sequence, .bypass-sequence {
        width: 100%;
        max-width: 600px;
        padding: 1rem;
    }
    .confirmation-tick {
        color: #47ffa8;
        padding-left: 1rem;
    }
    #bypass-button {
        background-color: #e082ff;
        color: #10141a;
        font-family: 'Share Tech Mono', monospace;
        border: none;
        padding: 10px 20px;
        margin-top: 20px;
        cursor: pointer;
        font-size: 1.1rem;
        text-shadow: 0 0 5px #e082ff;
        border-radius: 4px;
        transition: all 0.2s ease;
    }
    #bypass-button:hover {
        box-shadow: 0 0 15px #e082ff;
        transform: scale(1.05);
    }
    .progress-bar-container {
        width: 80%;
        height: 20px;
        border: 1px solid #61d2ff;
        border-radius: 4px;
        margin-top: 20px;
        padding: 2px;
    }
    .progress-bar {
        width: 0%;
        height: 100%;
        background-color: #61d2ff;
        border-radius: 2px;
        transition: width 0.5s linear;
    }
  </style>
</head>
<body>

  <div id="loading-overlay"></div>

  <canvas id="matrix-background"></canvas>
  <div class="scanlines"></div>

  <div class="container">
    <header>
      <button id="lock-button" title="Lock Session">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>
      </button>
      <h1>Hi, I'm Willie!<br><strong>Cybersecurity Grad, AI/ML Master's Student, Tech Enthusiast</strong></h1>
    </header>
    <section class="about">
      <h2>🧠 Bio</h2>
      <p>I'm Willie McClain — a lifelong learner and dedicated problem solver driven by curiosity and a passion for technology. I hold a Bachelor of Science in Information Technology with a focus on Cybersecurity from Capella University and am currently pursuing a Master of Science in Computer Science with a concentration in Artificial Intelligence and Machine Learning at Western Governors University.</p>
      <p>Through hands-on personal projects and home lab experiments, I'm gaining real-world experience in cybersecurity, automation, and applied AI. The purpose of this portfolio is to transform my theoretical knowledge into practical, demonstrable skills. It also serves as a platform to showcase my growth and capabilities to potential employers, mentors, friends, and family.</p>
      <p>I'm actively seeking an internship or rotational role where I can apply my skills, contribute to meaningful projects, and grow as a professional in the tech industry.</p>
       <p class="disclaimer"><strong>Disclaimer:</strong> All cybersecurity and hacking-related projects listed are strictly for ethical learning purposes and are developed in controlled lab environments that I own. None of these tools or techniques are used or promoted for illegal activities.</p>
    </section>

    <h2>🎓 Education & Projects</h2>
    <h3>Bachelor of Science in Information Technology</h3>
    <div class="card-list">
        <div class="card">
          <span class="card-label">Completed</span>
          <a class="card-title" href="https://github.com/0xrajneesh/Incident-Response-Projects-for-Beginners" target="_blank">Incident Response Projects</a>
          <div class="card-desc">I completed a series of simulated security incidents, including phishing scams and malware attacks. This hands-on practice taught me how to identify threats, analyze digital evidence, and follow the correct procedures to respond to an attack.</div>
        </div>
        <div class="card">
          <span class="card-label">Completed</span>
          <a class="card-title" href="https://github.com/TheresAFewConors/Sooty" target="_blank">Sooty – SOC Automation Tool</a>
          <div class="card-desc">I contributed to this Python tool that helps security analysts work faster by automating repetitive tasks. It automatically investigates suspicious links and IP addresses to quickly determine if they are malicious, saving valuable time during a security incident.</div>
        </div>
        <div class="card">
          <span class="card-label">Completed</span>
          <a class="card-title" href="https://github.com/LetsDefend/awesome-soc-analyst" target="_blank">awesome-soc-analyst</a>
          <div class="card-desc">I helped organize and contribute to this popular collection of learning materials for security analysts. It's a go-to resource for anyone looking to sharpen their skills in threat detection and response.</div>
        </div>
        <div class="card">
          <span class="card-label">Completed</span>
          <a class="card-title" href="https://github.com/Uttamydv/Cybersecurity-Homelab-and-Penetration-Testing-Project" target="_blank">Cybersecurity Homelab & Penetration Testing</a>
          <div class="card-desc">I built a virtual cybersecurity lab that mirrors a real corporate network. In this controlled environment, I practice finding and exploiting vulnerabilities using industry-standard tools, which helps me understand how to better defend against real-world attacks.</div>
        </div>
    </div>
    <h3>Master of Science in Computer Science</h3>
    <div class="card-list">
      <div class="card">
        <span class="card-label">Completed</span>
        <a class="card-title" href="https://nextjs-ai-chatbot-nine-ruby-16.vercel.app" target="_blank">Beginner AI Chatbot</a>
        <div class="card-desc">Python chatbot that responds to user input and stores simple memory using JSON.<br><strong>Click the link to test it live.</strong></div>
      </div>
      <div class="card">
        <span class="card-label">Planned</span>
        <a class="card-title" href="https://github.com/WillieLabs/Live-Translator-App" target="_blank">Live Translator App</a>
        <div class="card-desc">Real-time language translator using Google Translate API with optional voice input/output.</div>
      </div>
    </div>

    <section class="videos">
      <h2>📺 Popular YouTube Videos</h2>
      <ul>
        <li>Visit my channel: <a href="https://www.youtube.com/@TechTalksbyWillie" target="_blank">Tech Talks by Willie</a></li>
        <li>On this channel, I walk through the projects featured in my portfolio — explaining my thought process, demonstrating functionality, and helping others learn as I build.</li>
        <li>More videos and tutorials coming soon!</li>
      </ul>
    </section>

    <div class="links">
        <a href="Willie%20McClain%20Resume%202025%20PDF.pdf" download>⬇️ Download My Resume</a>
    </div>

    <div class="social">
      <a href="https://www.linkedin.com/in/williemcclain922/"><img alt="Willie | LinkedIn" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/linkedin.svg"></a>
      <a href="https://www.instagram.com/will22cool/"><img alt="Willie | Instagram" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/instagram.svg"></a>
      <a href="https://www.tiktok.com/@will22cool"><img alt="Willie | TikTok" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/tiktok.svg"></a>
      <a href="https://www.facebook.com/profile.php?id=100072569739964"><img alt="Willie | Facebook" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/facebook.svg"></a>
      <a href="https://www.upwork.com/freelancers/~013eca3ce95c0a28db?mp_source=share"><img alt="Willie | Upwork" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/upwork.svg"></a>
      <a href="https://www.youtube.com/@TechTalksbyWillie"><img alt="Willie | YouTube" src="https://cdn.jsdelivr.net/npm/simple-icons@v12/icons/youtube.svg"></a>
    </div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- STATE MANAGEMENT ---
    let stage = 'motd';
    let loginAttempts = 0; // Tracks password attempts
    let currentInput = 'username';
    let sounds = {};
    let isToneReady = false;
    let animationFrameIds = {};
    let storedUsername = '';

    // --- DOM REFERENCES ---
    const mainContainer = document.querySelector('.container');
    const lockButton = document.getElementById('lock-button');
    
    // --- TEXT-TO-SPEECH FUNCTION ---
    function speak(text, rate = 0.8, pitch = 0.7) {
        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel(); 
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = rate;
            utterance.pitch = pitch;
            window.speechSynthesis.speak(utterance);
        } else {
            console.warn("Text-to-speech is not supported in this browser.");
        }
    }

    // --- AUDIO SETUP ---
    async function setupAudio() {
        if (window.Tone && !isToneReady) {
            try {
                await Tone.start();
                sounds = {
                    error: new Tone.NoiseSynth({ noise: { type: 'brown' }, envelope: { attack: 0.01, decay: 0.15, sustain: 0, release: 0.1 } }).toDestination(),
                    typing: new Tone.MembraneSynth({ pitchDecay: 0.008, octaves: 2, envelope: { attack: 0.001, decay: 0.2, sustain: 0 } }).toDestination(),
                    success: new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.5 } }).toDestination(),
                    confirm: new Tone.Synth({oscillator: {type: 'triangle'}, envelope: {attack: 0.005, decay: 0.1, sustain: 0.3, release: 0.1}}).toDestination(),
                    bypass: new Tone.PluckSynth({attackNoise: 0.5, dampening: 4000, resonance: 0.9}).toDestination()
                };
                isToneReady = true;
            } catch (e) {
                console.error("Could not start audio context:", e);
            }
        }
    }
    
    // --- TRANSITION TO MAIN SITE ---
    function grantAccess() {
        speak('Access Granted. Welcome, Operator McClain.');
        if(isToneReady) sounds.success.triggerAttackRelease("C4", "0.5s");

        const overlay = document.getElementById('loading-overlay');
        if(overlay) overlay.style.opacity = '0';
        mainContainer.style.display = 'block';
        
        const matrixCanvas = document.getElementById('matrix-background');
        if (matrixCanvas) {
            matrixCanvas.style.display = 'block';
            // Clear any old interval just in case
            if (animationFrameIds.matrix) {
                clearInterval(animationFrameIds.matrix);
            }
            // Start the matrix effect
            runMatrixBackground();
        }
        
        document.body.style.overflow = 'auto';
        // Clear all timers EXCEPT the matrix one
        Object.keys(animationFrameIds).forEach(key => {
             if (key !== 'matrix') {
                clearTimeout(animationFrameIds[key]);
                clearInterval(animationFrameIds[key]);
            }
        });
        // Hide the overlay instead of removing it to prevent issues on restart
        setTimeout(() => {
            if (overlay) {
                overlay.style.display = 'none'; 
            }
        }, 500);
    }

    // --- RENDERING LOGIC ---
    function render() {
        const overlay = document.getElementById('loading-overlay');
        if (!overlay) return;
        overlay.innerHTML = '';
        
        Object.values(animationFrameIds).forEach(id => {
            clearTimeout(id);
            clearInterval(id);
        });
        animationFrameIds = {};

        switch (stage) {
            case 'motd':
                const bootContainer = document.createElement('div');
                bootContainer.className = 'boot-sequence';
                overlay.appendChild(bootContainer);
                const bootLines = [
                    `<span class="text-green-400">[&nbsp; OK&nbsp; ]</span> Initializing System Core...`,
                    `<span class="text-green-400">[&nbsp; OK&nbsp; ]</span> Loading Kernel v5.15.0-WM...`,
                    `<span class="text-yellow-400">[ INFO ]</span> Mounting file systems...`,
                    `<span class="text-green-400">[&nbsp; OK&nbsp; ]</span> Starting network services...`,
                    `<span class="text-yellow-400">[ INFO ]</span> Authenticating user...`,
                    `<span class="text-green-400">[&nbsp; OK&nbsp; ]</span> User authenticated: Willie McClain`,
                    `<span class="text-cyan-400">[ INFO ]</span> Welcome, Operator McClain.`,
                    `<span class="text-cyan-400">[ INFO ]</span> Loading user interface...`
                ];
                let lineIndex = 0;
                function typeNextBootLine() {
                    if (lineIndex >= bootLines.length) {
                        animationFrameIds.motdEnd = setTimeout(() => {
                            stage = 'login';
                            render();
                        }, 1000);
                        return;
                    }
                    const p = document.createElement('p');
                    p.innerHTML = bootLines[lineIndex];
                    bootContainer.appendChild(p);
                    if(isToneReady) sounds.typing.triggerAttackRelease('C1', '8n');
                    lineIndex++;
                    animationFrameIds.motdLine = setTimeout(typeNextBootLine, 300);
                }
                typeNextBootLine();
                break;

            case 'login':
                const form = document.createElement('form');
                form.className = 'font-mono text-green-400 text-sm md:text-base';
                let formHTML = '';
                if (loginAttempts > 0) {
                    formHTML += '<p class="text-yellow-400 mb-4">Authentication failed. Please try again.</p>';
                } else {
                    formHTML += '<p class="text-cyan-400 mb-4">Hint: Try any username/password combination</p>';
                }
                formHTML += '<div><span>user@willie.dev:~$ </span></div>';
                if (currentInput === 'username') {
                    formHTML += `<div><span>login: </span><input type="text" id="login-input" autocomplete="off" autofocus /></div>`;
                } else {
                    formHTML += `<div><span>login: ${storedUsername}</span></div>`;
                    formHTML += `<div><span>password: </span><input type="password" id="login-input" autocomplete="current-password" autofocus /></div>`;
                }
                form.innerHTML = formHTML;
                overlay.appendChild(form);
                const inputEl = document.getElementById('login-input');
                if (inputEl) inputEl.focus();
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    await setupAudio();
                    if (currentInput === 'username') {
                        storedUsername = inputEl.value;
                        if (!storedUsername.trim()) return;
                        currentInput = 'password';
                        render();
                    } else {
                        loginAttempts++;
                        stage = 'failed';
                        render();
                    }
                };
                break;

            case 'failed':
                const failedContainer = document.createElement('div');
                failedContainer.className = 'text-center';
                failedContainer.innerHTML = `<p class="text-red-500 text-xl mb-4">ACCESS DENIED</p>`;
                overlay.appendChild(failedContainer);

                speak('Access Denied');
                if(isToneReady) sounds.error.triggerAttackRelease("8n");

                if (loginAttempts >= 2) {
                    // After the second failure, show the bypass button.
                    const bypassButton = document.createElement('button');
                    bypassButton.id = 'bypass-button';
                    bypassButton.textContent = 'Initiate System Bypass';
                    failedContainer.appendChild(bypassButton);
                    bypassButton.onclick = () => {
                        stage = 'bypassing';
                        render();
                    };
                } else {
                    // After the first failure, automatically return to the login screen.
                    animationFrameIds.failDelay = setTimeout(() => {
                        stage = 'login';
                        render();
                    }, 1500);
                }
                break;

            case 'bypassing':
                runBypassAnimation();
                break;
        }
    }

    function runBypassAnimation() {
        const overlay = document.getElementById('loading-overlay');
        speak('Bypass initiated. Decrypting system files.');
        const bypassContainer = document.createElement('div');
        bypassContainer.className = 'bypass-sequence text-center';
        bypassContainer.innerHTML = `
            <p class="text-cyan-400 text-xl mb-4">[ DECRYPTION IN PROGRESS... ]</p>
            <div id="bypass-log" class="text-left text-sm text-green-400 h-48 overflow-y-auto"></div>
            <div class="progress-bar-container mx-auto">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <p id="progress-text" class="text-cyan-400 mt-2">0%</p>
        `;
        overlay.innerHTML = '';
        overlay.appendChild(bypassContainer);
        
        const log = document.getElementById('bypass-log');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        const totalDuration = 10000; // 10 seconds
        const intervalTime = 500; // 0.5 seconds
        let elapsedTime = 0;

        const bypassLines = [
            "> Locating encryption keys...",
            "> Analyzing AES-256 protocol...",
            "> Firewall detected. Rerouting traffic...",
            "> Exploiting kernel vulnerability CVE-2025-WM01...",
            "> Injecting payload...",
            "> Bypassing security layer 1/3... [DONE]",
            "> Escalating privileges to root...",
            "> Bypassing security layer 2/3... [DONE]",
            "> Disabling logging services...",
            "> Bypassing security layer 3/3... [DONE]",
            "> Cleaning tracks...",
            "> Decryption successful. Mounting filesystem..."
        ];
        let lineIndex = 0;

        const intervalId = setInterval(() => {
            elapsedTime += intervalTime;
            const percent = Math.min(100, Math.floor((elapsedTime / totalDuration) * 100));
            
            progressBar.style.width = `${percent}%`;
            progressText.textContent = `${percent}%`;

            if (isToneReady) sounds.bypass.triggerAttackRelease(percent < 90 ? 'C2' : 'G4', '16n', Tone.now() + 0.1);

            if (lineIndex < bypassLines.length && (elapsedTime % 1000 === 0)) {
                 const p = document.createElement('p');
                 p.textContent = bypassLines[lineIndex];
                 log.appendChild(p);
                 log.scrollTop = log.scrollHeight;
                 lineIndex++;
            }

            if (elapsedTime >= totalDuration) {
                clearInterval(intervalId);
                setTimeout(grantAccess, 1000);
            }
        }, intervalTime);

        animationFrameIds.bypass = intervalId;
    }
    
    function runMatrixBackground() {
        const canvas = document.getElementById('matrix-background');
        if (!canvas) return;
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const chars = 'W I L L I E'; // Changed characters
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);
        
        function draw() {
            ctx.fillStyle = 'rgba(16, 20, 26, 0.05)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#808080';
            ctx.font = `${fontSize}px monospace`;
            for (let i = 0; i < drops.length; i++) {
                const text = chars[Math.floor(Math.random() * chars.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        // Store the interval ID in a way that it won't be cleared by the main render loop
        if (animationFrameIds.matrix) clearInterval(animationFrameIds.matrix);
        animationFrameIds.matrix = setInterval(draw, 33);
    }
    
    // *** TASK 1 FIX: Corrected lock sequence animation ***
    function runLockSequence(callback) {
        const lockOverlay = document.createElement('div');
        lockOverlay.id = 'lock-overlay';
        const lockTerminal = document.createElement('div');
        lockTerminal.id = 'lock-terminal';
        lockOverlay.appendChild(lockTerminal);
        document.body.appendChild(lockTerminal); // Correctly append the terminal
        
        // Use a fade-in effect
        setTimeout(() => {
            lockTerminal.style.transition = 'opacity 0.3s ease';
            lockTerminal.style.opacity = '1';
        }, 10);

        speak('Security protocol engaged. Terminating session.');

        const lockLines = [
            { text: "> Running sudo kill -9 $(lsof -t -i:session)", delay: 800 },
            { text: "> Scrubbing volatile memory sectors...", delay: 1200 },
            { text: "> Purging temporary authentication tokens...", delay: 1000 },
            { text: "> Disconnecting from host...", delay: 800 },
            { text: "> [SESSION TERMINATED]", delay: 1500 }
        ];
        let lineIndex = 0;

        function typeNextLockLine() {
            if (lineIndex >= lockLines.length) {
                // End of sequence, call the callback to restart
                animationFrameIds.lockEnd = setTimeout(callback, 500);
                return;
            }

            const line = lockLines[lineIndex];
            const p = document.createElement('p');
            lockTerminal.appendChild(p);
            
            p.textContent = line.text; // Display the whole line at once for a more direct feel
            if(isToneReady) sounds.typing.triggerAttackRelease('C1', '8n');
            
            if (line.text.includes('...')) {
                 setTimeout(() => {
                    p.innerHTML += `<span class="confirmation-tick">[DONE]</span>`;
                    if(isToneReady) sounds.confirm.triggerAttackRelease("A5", "16n");
                }, line.delay / 2);
            }
            
            lineIndex++;
            animationFrameIds.lockLine = setTimeout(typeNextLockLine, line.delay);
        }
        typeNextLockLine();
    }

    // --- INITIALIZE & EVENT LISTENERS ---
    function initialize() {
        Object.keys(animationFrameIds).forEach(key => {
            clearTimeout(animationFrameIds[key]);
            clearInterval(animationFrameIds[key]);
        });
        animationFrameIds = {};
        
        const matrixCanvas = document.getElementById('matrix-background');
        if (matrixCanvas) matrixCanvas.style.display = 'none';
        
        let overlay = document.getElementById('loading-overlay');
        if (!overlay) {
             overlay = document.createElement('div');
             overlay.id = 'loading-overlay';
             document.body.prepend(overlay);
        }
        
        overlay.style.display = 'flex';
        overlay.style.opacity = '1';
        mainContainer.style.display = 'none';
        document.body.style.overflow = 'hidden';
        stage = 'motd';
        loginAttempts = 0;
        currentInput = 'username';
        storedUsername = '';
        render();
    }

    lockButton.addEventListener('click', () => {
        setupAudio();
        mainContainer.style.transition = 'opacity 0.3s';
        mainContainer.style.opacity = '0';
        
        // Ensure main container is hidden before showing lock sequence
        setTimeout(() => {
             mainContainer.style.display = 'none';
             runLockSequence(() => {
                const lockTerminal = document.getElementById('lock-terminal');
                if (lockTerminal) {
                    lockTerminal.style.opacity = '0';
                    setTimeout(() => {
                        lockTerminal.remove();
                        initialize();
                    }, 300);
                } else {
                    initialize();
                }
            });
        }, 300);
    });

    setupAudio();
    initialize();
});
</script>

</body>
</html>